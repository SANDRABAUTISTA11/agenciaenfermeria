<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Sistema Agencia</title>
  <link rel="stylesheet" href="estilos/paginaadministradores.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button"
        data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup">
        <span class="navbar-toggler-icon"></span>
      </button>
      <img src="imagenes/logo.png" width="30px" height="30px" alt="logo" />

      <div class="collapse navbar-collapse enlaces-navbar" id="navbarNavAltMarkup">
        <div class="navbar-nav mx-auto">
          <a class="navbar-brand" href="inicio.html">Inicio</a>
          <a class="navbar-brand" href="nosotros.html">Sobre Nosotros</a>
          <a class="navbar-brand" href="servicios.html">Nuestros Servicios</a>
          <a class="navbar-brand" href="contacto.html">Contacto</a>
        </div>
      </div>

      <a href="inicio.html" class="btn btn-outline-primary"
         style="color: rgb(4, 4, 70);">❌ Salir</a>
    </div>
  </nav>

  <div class="main-container">
    <h2>Sistema Agencia</h2>

    <div class="top-bar">
      <div id="semanaActual">📅 Semana actual: Cargando...</div>
      <div>👤 Usuario: Luis Escamilla</div>
    </div>

    <div class="info-bar">
      <div id="serviciosActivos">📄 Servicios activos: 1</div>
      <div id="totalSemanal">💰 Total semanal: $0 MXN</div>
    </div>

    <!-- Servicios existentes -->
    <div id="contenedorServicios">
      <div class="card">
        <p>🟢 <strong>Servicio:</strong> Cuidado adulto mayor</p>
        <p><strong>Cliente:</strong> </p>
        <p><strong>Dirección:</strong> </p>
        <p><strong>Horario:</strong>  | <strong>Inicio:</strong> </p>
        <p><strong>Estado:</strong> Activo [<span class="finalizar">Finalizar ❌</span>]</p>
      </div>
    </div>

    <!-- Formulario nuevo servicio -->
    <div class="new-service">
      <p>🔵 + NUEVO SERVICIO</p>
      <div class="form-group">
        <label for="nombreCliente">📛 Nombre del cliente:</label>
        <input type="text" id="nombreCliente" />
      </div>
      <div class="form-group">
        <label for="tipoServicio">🛠 Tipo de servicio:</label>
        <input type="text" id="tipoServicio" />
      </div>
      <div class="form-group">
        <label for="direccion">📍 Dirección del servicio:</label>
        <input type="text" id="direccion" />
      </div>
      <div class="form-group">
        <label for="fechaInicio">📅 Fecha de inicio:</label>
        <input type="date" id="fechaInicio" />
      </div>
      <div class="form-group">
        <label for="horarioAtencion">⏰ Horario de atención:</label>
        <input type="text" id="horarioAtencion" placeholder="Ej. 9:00 – 15:00" />
      </div>
      <div class="form-group">
        <label for="pagoPorDia">💵 Pago por día ($MXN):</label>
        <input type="number" id="pagoPorDia" />
      </div>

      <div class="buttons">
        <button type="button" class="save-btn">💾 GUARDAR SERVICIO</button>
        <button type="button" class="cancel-btn">❌ CANCELAR</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="networking-social">
      <a href="https://www.facebook.com/Porlasaludentuhogar">
        <img src="imagenes/facebook-svgrepo-com (1).png" alt="facebook" />
      </a>
      <a href="https://www.instagram.com/ag_enfermeria_cuidado_familiar/">
        <img src="imagenes/insta.jpg" alt="instagram" />
      </a>
      <a href="mailto:agcuidadofamiliar@gmail.com">
        <img src="imagenes/gmail.jpg" alt="gmail" />
      </a>
      <a href="https://wa.me/5584695981">
        <img src="imagenes/whatsap.jpg" alt="whatsap" />
      </a>
    </div>
    <div class="text-footer">
      <span>Innova LS Tech |</span>
      <span>Todos los derechos reservados |</span>
      <span>Aviso de privacidad</span>
    </div>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const guardarBtn = document.querySelector(".save-btn");
      const cancelarBtn = document.querySelector(".cancel-btn");
      const inputs = document.querySelectorAll(".new-service input");
      const contenedorServicios = document.getElementById("contenedorServicios");
      const totalSemanal = document.getElementById("totalSemanal");
      const serviciosActivos = document.getElementById("serviciosActivos");

      let totalActual = 0;
      let serviciosContador = contenedorServicios.querySelectorAll(".card").length;

      actualizarTotal();
      actualizarSemanaActual();

      guardarBtn.addEventListener("click", () => {
        const [nombre, tipo, direccion, fecha, horario, pago] = Array.from(inputs).map(input => input.value.trim());

        if (!nombre || !tipo || !direccion || !fecha || !horario || !pago) {
          alert("Por favor completa todos los campos.");
          return;
        }

        const nuevaCard = document.createElement("div");
        nuevaCard.classList.add("card");
        nuevaCard.innerHTML = `
          <p>🟢 <strong>Servicio:</strong> ${tipo}</p>
          <p><strong>Cliente:</strong> ${nombre}</p>
          <p><strong>Dirección:</strong> ${direccion}</p>
          <p><strong>Horario:</strong> ${horario} | <strong>Inicio:</strong> ${fecha}</p>
          <p><strong>Estado:</strong> Activo [<span class="finalizar">Finalizar ❌</span>]</p>
        `;

        contenedorServicios.insertBefore(nuevaCard, contenedorServicios.firstChild);

        totalActual += parseFloat(pago);
        serviciosContador += 1;
        actualizarTotal();
        inputs.forEach(input => input.value = "");

        agregarFinalizarListener(nuevaCard.querySelector(".finalizar"));
      });

      cancelarBtn.addEventListener("click", () => {
        if (confirm("¿Deseas cancelar y borrar los datos ingresados?")) {
          inputs.forEach(input => input.value = "");
        }
      });

      function agregarFinalizarListener(boton) {
        boton.addEventListener("click", () => {
          const confirmar = confirm("¿Finalizar este servicio?");
          if (confirmar) {
            const card = boton.closest(".card");
            const estadoParrafo = boton.parentElement;
            estadoParrafo.innerHTML = "<strong>Estado:</strong> Finalizado ✅ <button class='eliminar-btn'>🗑 Eliminar</button>";
            serviciosContador -= 1;
            actualizarTotal();

            const eliminarBtn = estadoParrafo.querySelector(".eliminar-btn");
            eliminarBtn.addEventListener("click", () => {
              if (confirm("¿Eliminar este servicio?")) {
                card.remove();
              }
            });
          }
        });
      }

      function actualizarTotal() {
        totalSemanal.textContent = `💰 Total semanal: $${totalActual.toLocaleString()} MXN`;
        serviciosActivos.textContent = `📄 Servicios activos: ${serviciosContador}`;
      }

      function actualizarSemanaActual() {
        const hoy = new Date();
        const dia = hoy.getDay();
        const diferencia = hoy.getDate() - dia + (dia === 0 ? -6 : 1);
        const lunes = new Date(hoy.setDate(diferencia));
        const domingo = new Date(lunes);
        domingo.setDate(lunes.getDate() + 6);

        const opciones = { day: '2-digit', month: 'short', year: 'numeric' };
        const textoSemana = `${lunes.toLocaleDateString('es-MX', opciones)} – ${domingo.toLocaleDateString('es-MX', opciones)}`;
        document.getElementById("semanaActual").textContent = `📅 Semana actual: ${textoSemana}`;
      }

      document.querySelectorAll(".finalizar").forEach(agregarFinalizarListener);
    });
  </script>
</body>
</html>
